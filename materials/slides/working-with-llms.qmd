---
format: 
  revealjs:
    width: 1600
    height: 920
    max-scale: 1
    min-scale: 1
    smaller: true
    transition: fade
    background-transition: fade
    theme: theme.scss
    code-line-numbers: false
    menu: true
    code-block-height: 640px
    slide-number: true
engine: knitr
---

```{r}
#| include: false
if(!("working_with_llms" %in% ls())) working_with_llms <- 1
```

# {background-image="assets/background/content-slide.svg" background-size="1700px" background-color="#2a7070"}

:::{.content-slide-title}
Unit `r working_with_llms`
:::

:::{.content-slide}
Working with <br/> 
LLMs in <br/> 
Databricks
:::

## {background-image="assets/background/boxed-white.svg" background-size="1700px" background-color="#2a7070"}

<br/><br/><br/><br/><br/>

:::{.columns}
:::{.column width="5%"}
:::
:::{.column width="95%"}
:::{.content-slide}
[Enhance SQL operations using LLM's]{style="font-size:130px; line-height: 0.5;"}
:::
:::
:::


## [Databricks LLMs via SQL]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}

:::{.columns}
:::{.column width="46%"}
:::{.custom2}
:::{.incremental1}
- Databricks allows us to access LLM functionality right from SQL 
- Accessible via calling the `ai_` family of functions
- Adds new way of leveraging LLMs, batch scoring
:::
:::
:::
:::{.column width="54%"}

<br/><br/>

:::{.code-slim-45}
```sql
> SELECT ai_analyze_sentiment('I am happy');
  positive
```
:::

<br/>

:::{.code-slim-45}
```sql
> SELECT ai_analyze_sentiment('I am sad');
  negative
```
:::
:::
:::

:::{.footer}
https://docs.databricks.com/en/large-language-models/ai-functions-example.html
:::

## [Call *ai* functions in dplyr]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}

![](assets/remote-processing/dplyr.png){.absolute top="0" left="1410" width="90"}
![](assets/remote-processing/dbplyr.png){.absolute top="0" left="1500" width="90"}

:::{.columns}
:::{.column width="40%"}
:::{.custom2}
:::{.incremental1}
- Easily access the `ai` functions by calling them via `dplyr` verbs
- `dbplyr` passes unrecognized functions 'as-is' in the query
:::
:::
:::
:::{.column width="60%"}
:::{.code-slim-35}
```r
orders |>
  head() |> 
  select(o_comment) |> 
  mutate(sentiment = ai_analyze_sentiment(o_comment)) 
  
#> # Source:   SQL [6 x 2]
#> # Database: Spark SQL 3.1.1[token@Spark SQL/hive_metastore]
#>   o_comment                         sentiment
#>   <chr>                                  <chr>    
#> 1 ", pending theodolites …     neutral  
#> 2 "uriously special foxes …     neutral  
#> 3 "sleep. courts after the …    neutral  
#> 4 "ess foxes may sleep …      neutral  
#> 5 "ts wake blithely unusual …  mixed    
#> 6 "hins sleep. fluffily …            neutral
```
:::
:::
:::

## [Available LLM functions]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}

:::{.columns}
:::{.column width="7%"}
:::
:::{.column width="90%"}
:::{.incremental1}
:::{.sample-code}
- `ai_analyze_sentiment` - [Text is positve, negative, neutral, etc.]{style="font-size: 45px;"}
- `ai_classify` - [Give choices, LLM chooses which of the choice match]{style="font-size: 45px;"}
- `ai_extract` - [Have LLM extract specific elements from the text]{style="font-size: 45px;"}
- `ai_fix_grammar` - [Makes grammar more better]{style="font-size: 45px;"}
- `ai_mask` - [Replaces specified elements with '[Masked]']{style="font-size: 45px;"}
- `ai_similarity` - [Compares 2 texts, returns integer indicating similarity]{style="font-size: 45px;"}
- `ai_summarize` - [Summarizes text, you can also specify length of output]{style="font-size: 45px;"}
- `ai_translate` - [Tell LLM to translate to specific language]{style="font-size: 45px;"}
- `ai_forecast` - [Time series prediction, not text]{style="font-size: 45px;"}
:::
:::
:::
:::
