---
format: 
  revealjs:
    width: 1600
    height: 920
    max-scale: 1
    min-scale: 1
    smaller: true
    transition: fade
    background-transition: fade
    theme: theme.scss
    code-line-numbers: false
    menu: true
    code-block-height: 640px
    slide-number: true
engine: knitr
---

```{r, setup}
#| include: false
#| file: setup.R
```

## {background-image="assets/background/content-slide.svg" background-size="1700px" background-color="#2a7070"}

:::{.content-slide-title}
Unit `r unit_no`
:::

:::{.content-slide}
Accessing <br/> Databricks 
:::

## [Using RStudio]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}

:::{.custom2}
In the *"Connections"* pane, select *"New Connection"*
:::

![](assets/01/connection-1.png){.absolute top="230" left="130" width="1200"}

## [Using RStudio]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}

:::{.custom2}
Select *'warehouse'*
:::

![](assets/01/connection-2.png){.absolute top="230" left="450" width="700"}

## [Using RStudio]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}

:::{.custom2}
Click *'OK'*
:::

![](assets/01/connection-3.png){.absolute top="230" left="450" width="700"}

## [RStudio DB Navigator]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}

:::{.custom2}
Explore the catalogs, schema and tables
:::

![](assets/posit-databricks.png){.absolute top="-10" left="1430" width="180"}

![](assets/01/connection-4.png){.absolute top="230" left="350" width="900"}

## {background-image="assets/background/boxed-green.svg" background-size="1700px" background-color="#799857"}

:::{.green-slide}
Exercises `r unit_no`.1 - `r unit_no`.2
:::

## [How everything connects]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}

![](assets/01/odbc.png){.absolute top="120" left="120"}

## [Connecting - Good]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}

:::{.sample-code}

`dbConnect()` & `odbc::odbc()` lets you easily connect to the SQL Warehouse

```{r}
#| eval: false
#| echo: true
#| code-line-numbers: "|1|2|3|4-5|6|7-12"

con <- dbConnect(
  odbc::odbc(),
  Driver = ".../lib/libsparkodbc_sb64-universal.dylib",
  Host = Sys.getenv("DATABRICKS_HOST"),
  PWD = Sys.getenv("DATABRICKS_TOKEN"),
  HTTPPath = "/sql/1.0/warehouses/300bd24ba12adf8e",
  Port = 443,
  AuthMech = 3,
  Protocol = "https",
  ThriftTransport = 2,
  SSL = 1,
  UID = "token"
)
```
:::

:::{.footer}
https://solutions.posit.co/connections/db/databases/databricks/#using-the-odbcodbc-function
:::

## [Connecting - Better]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}

![](assets/posit-databricks.png){.absolute top="-10" left="1430" width="180"}

:::{.sample-code}
:::{.incremental1}
- `odbc::databricks()` super simplifies the setup
- Automatically detects credentials, driver, and sets default arguments
- `HTTPPath` is the only argument that you will need
:::
:::

<br/>

:::{.columns}
::: {.column width="10%"}
:::

::: {.column width="80%"}
:::{.sample-code}
```{r}
#| eval: false
#| echo: true

con <- dbConnect(
  odbc::databricks(),
  HTTPPath = "/sql/1.0/warehouses/300bd24ba12adf8e"
)
```
:::
:::
:::

:::{.footer}
https://solutions.posit.co/connections/db/databases/databricks/#using-the-new-odbcdatabricks-function
:::

## {background-image="assets/background/boxed-green.svg" background-size="1700px" background-color="#799857"}

:::{.green-slide}
Exercises `r unit_no`.3 - `r unit_no`.4
:::


## [Using DBI]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}
<br/>

:::{.columns}
:::{.column width="10%"}

:::
:::{.column width="90%"}
:::{.custom2}
- `dbConnect()` - Connects to the database
- `dbDisconnect()` - Disconnects the database
- `dbListTables()` - Lists the tables 
- `dbListFields()` - Lists the fields of a table 
- `dbGetQuery()` - Runs the query & collects results
:::
:::
:::

## {background-image="assets/background/boxed-green.svg" background-size="1700px" background-color="#799857"}

:::{.green-slide}
Exercise `r unit_no`.5
:::

## [How everything connects (Revisited)]{style="color:#666;"}   {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}

![](assets/01/odbc.png){.absolute top="120" left="120"}

## [Other RStudio interfaces]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}

<br/>

:::{.columns}
:::{.column}
:::{.custom2}
`knitr` SQL engine 
:::
:::
:::{.column}
:::{.custom2}
RStudio SQL script
:::
:::
:::

![](assets/01/sql-knitr.png){.absolute top="300" left="20" width="800"}
![](assets/01/sql-script.png){.absolute top="300" left="850" width="600"}
![](assets/01/sql-script-result.png){.absolute top="450" left="975" width="600"}

## {background-image="assets/background/boxed-green.svg" background-size="1700px" background-color="#799857"}

:::{.green-slide}
Exercise `r unit_no`.6 - `r unit_no`.7
:::
