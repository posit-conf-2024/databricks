---
format: 
  revealjs:
    width: 1600
    height: 920
    max-scale: 1
    min-scale: 1
    smaller: true
    transition: fade
    background-transition: fade
    theme: theme.scss
    code-line-numbers: false
    menu: true
    code-block-height: 640px
    slide-number: true
engine: knitr
---

```{r, setup}
#| include: false
#| file: setup.R
```

## {background-image="assets/background/content-slide.svg" background-size="1700px" background-color="#2a7070"}

:::{.content-slide-title}
Unit `r unit_no`
:::

:::{.content-slide}
More about <br/>
`dplyr` & <br/>
`dbplyr`
:::


## [Data collection]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}
:::{.custom2}
There are 3 commands that download data:
:::

:::{.columns}

:::{.column width="55%"}

:::{.custom2}
- `print()` - Downloads the first 1K rows by default (Guardrails)
- `collect()` - Downloads **all** of the data
- `pull()` - Download **all** the data of a single field
:::
:::

:::{.column width="45%"}
[
tbl_cars <- **tbl**(con, "cars")<br/>
**print**(tbl_cars)<br/>
tbl_cars [#Print is implied]{style="color:#aaa"} <br/>
**collect**(tbl_cars) <br/>
**pull**(tbl_cars, mpg) 
]{style="color:#666; font-family:Helvetica Neue; font-weight:150;font-size:65px;line-height:1.8;"} 
:::
:::

## {background-image="assets/background/boxed-green.svg" background-size="1700px" background-color="#799857"}

:::{.green-slide}
Exercise `r unit_no`.1
:::

## [Databricks Unity Catalog (UC)]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}

:::{.custom2}
Centralizes access control, auditing, lineage, and data discovery across workspaces.
:::

![](assets/03/object-model.png){.absolute top="280" left="300"}

::: footer
https://docs.databricks.com/en/data-governance/unity-catalog/index.html
:::

## [Accessing the UC]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}

:::{.custom2}
*"diamonds"* can be accessed without specifying catalog and schema
:::

<br/><br/><br/>
[
# Why do you work?! <br/>
]{style="color:#999; font-family:Helvetica Neue; font-weight:200;font-size:60px; line-height: 0.8"} 
[
**tbl**(con, "diamonds") 
]{style="color:#666; font-family:Helvetica Neue; font-weight:200;font-size:80px; line-height: 1.1"} 

![](assets/03/uc-default1.png){.absolute top="280" left="800" width="850"}

## [Accessing the UC]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}

:::{.custom2}
*"hive_metastore"* & *"default"* are the default catalog & schema respectively 
:::

<br/><br/><br/>
[
# Oooh, that's why! <br/>
]{style="color:#999; font-family:Helvetica Neue; font-weight:200;font-size:60px; line-height: 0.8"} 
[
**tbl**(con, "diamonds") 
]{style="color:#666; font-family:Helvetica Neue; font-weight:200;font-size:80px; line-height: 1.1"} 

![](assets/03/uc-default2.png){.absolute top="280" left="800" width="850"}

## [Non-default catalog]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}

:::{.custom2}
How do I access tables not in the default catalog?
:::

[
**tbl**(con, "customer") 
]{style="color:#666; font-family:Helvetica Neue; font-weight:200;font-size:70px;"} 
<br/>
[
x (31740) Table or view not found: ..customer
]{style="color:#bc544b; font-family:Helvetica Neue; font-weight:400;font-size:35px; line-height: 1.1"} 

![](assets/03/uc-customer.png){.absolute top="210" left="820" width="820"}

## [Non-default catalog]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}

:::{.custom2}
How do I access tables not in the default catalog?
:::

[
**tbl**(con, "customer") 
]{style="color:#666; font-family:Helvetica Neue; font-weight:200;font-size:70px;"} 
<br/>
[
x (31740) Table or view not found: ..customer
]{style="color:#bc544b; font-family:Helvetica Neue; font-weight:400;font-size:35px; line-height: 1.1"} 
<br/><br/>
[
**tbl**(<br/>
[X]{style="color: #fff;"}con, <br/>
[X]{style="color: #fff;"}"samples.tpch.customer"<br/>
[X]{style="color: #fff;"})<br/>
]{style="color:#666; font-family:Helvetica Neue; font-weight:200;font-size:70px; line-height: 1.1"} 
[
x (31740) Table or view not found: ..samples.tpch.<br/>customer
]{style="color:#bc544b; font-family:Helvetica Neue; font-weight:400;font-size:35px; line-height: 1.1"} 

![](assets/03/uc-customer.png){.absolute top="210" left="820" width="820"}


## [Non-default catalog]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}

:::{.custom2}
Use `I()` to create the correct table reference
:::
<br/>
<br/>
[
**tbl**(<br/>
[X]{style="color: #fff;"}con, <br/>
[X]{style="color: #fff;"}**I**("samples.tpch.customer")<br/>
[X]{style="color: #fff;"})<br/>
]{style="color:#666; font-family:Helvetica Neue; font-weight:200;font-size:70px; line-height: 1.1"} 

![](assets/03/uc-customer.png){.absolute top="210" left="820" width="820"}

:::{.footer}
https://www.tidyverse.org/blog/2024/04/dbplyr-2-5-0/#referring-to-tables-in-a-schema
:::

## {background-image="assets/background/boxed-green.svg" background-size="1700px" background-color="#799857"}

:::{.green-slide}
Exercise `r unit_no`.2
:::

## [Variable selection]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}
:::{.custom2}
Using `select()` with these functions make variable selection easy: 
:::

:::{.columns}
:::{.column width="10%"}
:::
:::{.column width="80%"}
:::{.custom2}
- `starts_with()` - Starts with an exact prefix
- `ends_with()` - Ends with an exact suffix
- `contains()` - Contains a literal string
- `everything()` - Selects everything else. Use with other selection functions.
:::
:::
:::

## {background-image="assets/background/boxed-green.svg" background-size="1700px" background-color="#799857"}

:::{.green-slide}
Exercise `r unit_no`.3
:::

## [Joining tables]{style="color:#666;"} {background-image="assets/background/slide-light.svg" background-size="1700px" background-color="white"}

![](assets/03/join-x.png){.absolute top="100" left="600"}
![](assets/03/join-y.png){.absolute top="100" left="800"}

<br/><br/><br/><br/><br/><br/>

:::{.columns}
:::{.column width="10%"}
:::
:::{.column width="30%"}
`left_join()`
:::
:::{.column width="30%"}
`right_join()`
:::
:::{.column width="30%"}
`full_join()`
:::
:::

![](assets/03/join-left.png){.absolute top="500" left="170"}
![](assets/03/join-right.png){.absolute top="500" left="660"}
![](assets/03/join-full.png){.absolute top="500" left="1150"}

## {background-image="assets/background/boxed-green.svg" background-size="1700px" background-color="#799857"}

:::{.green-slide}
Exercise `r unit_no`.4
:::
