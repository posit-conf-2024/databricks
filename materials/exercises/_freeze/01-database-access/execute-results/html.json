{
  "hash": "f53fc70bf8550b84f84d82d7784d3ee8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Access a database\"\nexecute: \n  eval: true\n  freeze: true\n---\n\n\n## Connect to a database\n\n1. Click on the `Connections` tab\n\n1. Click on the `New Connection` button\n\n1. Select `Databricks Warehouse`\n\n1. Click OK\n\n## Explore the database using the RStudio IDE\n\n1. Expand the `samples` catalog\n\n1. Expand the `tpch` schema\n\n1. Expand the `customer` table\n\n1. Click on the table icon to the right of the `customer` table \n\n1. *(Optional)* Expand and explore the other tables\n\n1. Click on the *disconnect* icon to close the connection\n\n\n## List drivers and DSNs \n\n1. To get a list of drivers available in the server\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(odbc)\n\nodbcListDrivers()[1:2]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] name      attribute\n<0 rows> (or 0-length row.names)\n```\n\n\n:::\n:::\n\n\n2. Click on the *ellipsis* button located in the **Files** tab\n\n3. Type: `/etc`\n\n4. Locate and open the `odbcinst.ini` file\n\n5. To see a list of DSNs available in the server\n\n::: {.cell}\n\n```{.r .cell-code}\nodbcListDataSources()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       name                                                description\n1 warehouse /Library/simba/spark/lib/libsparkodbc_sb64-universal.dylib\n```\n\n\n:::\n:::\n\n\n6. Using the *ellipsis* button again, navigate to `/etc/odbc.ini`\n\n## Connect to a database using code\n\n1. Run the following code to connect\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(DBI)\ncon <- dbConnect(odbc::odbc(), dsn = \"warehouse\")\n```\n:::\n\n\n2. Use `dbListTables()` to retrieve a list of tables\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndbListTables(con)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"allergies\"                                                \n [2] \"cars\"                                                     \n [3] \"conditions\"                                               \n [4] \"covid_stats\"                                              \n [5] \"diamonds\"                                                 \n [6] \"edgartest\"                                                \n [7] \"encounters\"                                               \n [8] \"forevertables\"                                            \n [9] \"iris\"                                                     \n[10] \"lendingclub\"                                              \n[11] \"mytable\"                                                  \n[12] \"mytable3\"                                                 \n[13] \"neverchairs\"                                              \n[14] \"nevertables\"                                              \n[15] \"observations\"                                             \n[16] \"patients\"                                                 \n[17] \"people10m\"                                                \n[18] \"procedures\"                                               \n[19] \"providers\"                                                \n[20] \"sklearn_housing\"                                          \n[21] \"snotel_data\"                                              \n[22] \"test_write_table_new_ca1f2d28_2e14_4514_9d6e_2bd705b02c75\"\n[23] \"wx_data\"                                                  \n[24] \"sales_order_in_chicago\"                                   \n[25] \"sales_order_in_la\"                                        \n[26] \"sales_orders_cleaned\"                                     \n[27] \"sales_orders_raw\"                                         \n```\n\n\n:::\n:::\n\n\n3. Use `dbGetQuery()` to run a quick query\n\n::: {.cell}\n\n```{.r .cell-code}\nodbc::dbGetQuery(con, \"SELECT * FROM samples.tpch.customer LIMIT 10\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   c_custkey             c_name                                c_address\n1     412445 Customer#000412445                     0QAB3OjYnbP6mA0B,kgf\n2     412446 Customer#000412446      5u8MSbyiC7J,7PuY4Ivaq1JRbTCMKeNVqg \n3     412447 Customer#000412447        HC4ZT62gKPgrjr ceoaZgFOunlUogr7GO\n4     412448 Customer#000412448                              hJok1MMrDgH\n5     412449 Customer#000412449     zAt1nZNG01gOhIqgyDtDa S,Y0VSofZJs1dd\n6     412450 Customer#000412450                               fUD6IoGdtF\n7     412451 Customer#000412451                              W2Ge0Qd8adH\n8     412452 Customer#000412452                       Ij4xiPIeNEP1uR5p7H\n9     412453 Customer#000412453 4DmSxDPMmfidKQB3W50FIzkjZESEW3LPgLBuQbic\n10    412454 Customer#000412454                              ZQfKDMUyEfn\n   c_nationkey         c_phone c_acctbal c_mktsegment\n1           21 31-421-403-4333   5358.33     BUILDING\n2           20 30-487-949-7942   9441.59    MACHINERY\n3            7 17-797-466-6308   7868.75   AUTOMOBILE\n4            6 16-541-510-4964   6060.98    MACHINERY\n5           14 24-710-983-5536   4973.84    HOUSEHOLD\n6           20 30-293-696-5047   4406.28     BUILDING\n7           20 30-590-724-6711   2290.38     BUILDING\n8           10 20-492-590-3363   3426.64   AUTOMOBILE\n9           21 31-480-724-9665   4592.14    MACHINERY\n10           9 19-898-261-2669   2035.91    FURNITURE\n                                                                                                  c_comment\n1                                                                             arefully blithely regular epi\n2    sleep according to the fluffily even forges. fluffily careful packages after the ironic, silent deposi\n3                                                          aggle blithely among the carefully express excus\n4                                ly silent requests boost slyly. express courts sleep according to the fluf\n5                         refully final theodolites. final, slow excuses sleep quickly! quickly ironic idea\n6         refully final dolphins after the carefully bold packages sleep quickly express deposits. fluffily\n7                                      slow asymptotes will are carefully final packages. slyly regular fox\n8  sleep slyly after the sometimes even ideas. slyly express theodolites dazzle furiously ironic dependenci\n9                                 against the slyly regular requests-- pending, pending accounts boost quic\n10                                                    quickly. blithely special theodolites about the excus\n```\n\n\n:::\n:::\n\n\n4. Use the SQL chunk\n\n::: {.cell}\n\n```{.sql .cell-code}\nSELECT * FROM samples.tpch.customer LIMIT 10\n```\n\n\n<div class=\"knitsql-table\">\n\n\nTable: Displaying records 1 - 10\n\n|c_custkey |c_name             |c_address                                | c_nationkey|c_phone         | c_acctbal|c_mktsegment |c_comment                                                                                                |\n|:---------|:------------------|:----------------------------------------|-----------:|:---------------|---------:|:------------|:--------------------------------------------------------------------------------------------------------|\n|412445    |Customer#000412445 |0QAB3OjYnbP6mA0B,kgf                     |          21|31-421-403-4333 |   5358.33|BUILDING     |arefully blithely regular epi                                                                            |\n|412446    |Customer#000412446 |5u8MSbyiC7J,7PuY4Ivaq1JRbTCMKeNVqg       |          20|30-487-949-7942 |   9441.59|MACHINERY    |sleep according to the fluffily even forges. fluffily careful packages after the ironic, silent deposi   |\n|412447    |Customer#000412447 |HC4ZT62gKPgrjr ceoaZgFOunlUogr7GO        |           7|17-797-466-6308 |   7868.75|AUTOMOBILE   |aggle blithely among the carefully express excus                                                         |\n|412448    |Customer#000412448 |hJok1MMrDgH                              |           6|16-541-510-4964 |   6060.98|MACHINERY    |ly silent requests boost slyly. express courts sleep according to the fluf                               |\n|412449    |Customer#000412449 |zAt1nZNG01gOhIqgyDtDa S,Y0VSofZJs1dd     |          14|24-710-983-5536 |   4973.84|HOUSEHOLD    |refully final theodolites. final, slow excuses sleep quickly! quickly ironic idea                        |\n|412450    |Customer#000412450 |fUD6IoGdtF                               |          20|30-293-696-5047 |   4406.28|BUILDING     |refully final dolphins after the carefully bold packages sleep quickly express deposits. fluffily        |\n|412451    |Customer#000412451 |W2Ge0Qd8adH                              |          20|30-590-724-6711 |   2290.38|BUILDING     |slow asymptotes will are carefully final packages. slyly regular fox                                     |\n|412452    |Customer#000412452 |Ij4xiPIeNEP1uR5p7H                       |          10|20-492-590-3363 |   3426.64|AUTOMOBILE   |sleep slyly after the sometimes even ideas. slyly express theodolites dazzle furiously ironic dependenci |\n|412453    |Customer#000412453 |4DmSxDPMmfidKQB3W50FIzkjZESEW3LPgLBuQbic |          21|31-480-724-9665 |   4592.14|MACHINERY    |against the slyly regular requests-- pending, pending accounts boost quic                                |\n|412454    |Customer#000412454 |ZQfKDMUyEfn                              |           9|19-898-261-2669 |   2035.91|FURNITURE    |quickly. blithely special theodolites about the excus                                                    |\n\n</div>\n:::\n\n\n5. Use the `output.var` option to load results to a variable\n\n::: {.cell output.var='sql_top10'}\n\n```{.sql .cell-code}\nSELECT * FROM samples.tpch.customer LIMIT 10\n```\n:::\n\n\n6. Test the variable\n\n::: {.cell}\n\n```{.r .cell-code}\nsql_top10\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   c_custkey             c_name                                c_address\n1     412445 Customer#000412445                     0QAB3OjYnbP6mA0B,kgf\n2     412446 Customer#000412446      5u8MSbyiC7J,7PuY4Ivaq1JRbTCMKeNVqg \n3     412447 Customer#000412447        HC4ZT62gKPgrjr ceoaZgFOunlUogr7GO\n4     412448 Customer#000412448                              hJok1MMrDgH\n5     412449 Customer#000412449     zAt1nZNG01gOhIqgyDtDa S,Y0VSofZJs1dd\n6     412450 Customer#000412450                               fUD6IoGdtF\n7     412451 Customer#000412451                              W2Ge0Qd8adH\n8     412452 Customer#000412452                       Ij4xiPIeNEP1uR5p7H\n9     412453 Customer#000412453 4DmSxDPMmfidKQB3W50FIzkjZESEW3LPgLBuQbic\n10    412454 Customer#000412454                              ZQfKDMUyEfn\n   c_nationkey         c_phone c_acctbal c_mktsegment\n1           21 31-421-403-4333   5358.33     BUILDING\n2           20 30-487-949-7942   9441.59    MACHINERY\n3            7 17-797-466-6308   7868.75   AUTOMOBILE\n4            6 16-541-510-4964   6060.98    MACHINERY\n5           14 24-710-983-5536   4973.84    HOUSEHOLD\n6           20 30-293-696-5047   4406.28     BUILDING\n7           20 30-590-724-6711   2290.38     BUILDING\n8           10 20-492-590-3363   3426.64   AUTOMOBILE\n9           21 31-480-724-9665   4592.14    MACHINERY\n10           9 19-898-261-2669   2035.91    FURNITURE\n                                                                                                  c_comment\n1                                                                             arefully blithely regular epi\n2    sleep according to the fluffily even forges. fluffily careful packages after the ironic, silent deposi\n3                                                          aggle blithely among the carefully express excus\n4                                ly silent requests boost slyly. express courts sleep according to the fluf\n5                         refully final theodolites. final, slow excuses sleep quickly! quickly ironic idea\n6         refully final dolphins after the carefully bold packages sleep quickly express deposits. fluffily\n7                                      slow asymptotes will are carefully final packages. slyly regular fox\n8  sleep slyly after the sometimes even ideas. slyly express theodolites dazzle furiously ironic dependenci\n9                                 against the slyly regular requests-- pending, pending accounts boost quic\n10                                                    quickly. blithely special theodolites about the excus\n```\n\n\n:::\n:::\n\n\n7. Disconnect from the database using `dbDisconnect()`\n\n::: {.cell}\n\n```{.r .cell-code}\ndbDisconnect(con)\n```\n:::\n\n\n## RStudio SQL Script\n\n*Try out the new SQL Script support in RStudio*\n\n1. Open the *query-example.sql* file\n\n1. Click the *Preview* button. It is located in the top-right area of the script\n\n1. In the script, change *customer* to *orders*\n\n1. Click on *Preview* again\n\n## Connect to a database without a DSN\n*A more complex way of connecting to a database https://solutions.posit.co/connections/db/databases/databricks/#using-the-odbcodbc-function*\n\n1. Use the following code to start a new connection that does not use the pre-defined DSN\n\n::: {.cell}\n\n```{.r .cell-code}\ncon <- dbConnect(\n  odbc::odbc(),\n  Driver = \"/Library/simba/spark/lib/libsparkodbc_sb64-universal.dylib\",\n  Host = Sys.getenv(\"DATABRICKS_HOST\"),\n  Port = 443,\n  AuthMech = 3,\n  HTTPPath = \"/sql/1.0/warehouses/300bd24ba12adf8e\",\n  Protocol = \"https\",\n  ThriftTransport = 2,\n  SSL = 1,\n  UID = \"token\",\n  PWD = Sys.getenv(\"DATABRICKS_TOKEN\")\n  )\n```\n:::\n\n\n2. Disconnect from the database using `dbDisconnect()`\n\n::: {.cell}\n\n```{.r .cell-code}\ndbDisconnect(con)\n```\n:::\n\n\n## Connect to a database without a DSN, a better option\n*A more complex way of connecting to a database https://solutions.posit.co/connections/db/databases/databricks/#using-the-new-odbcdatabricks-function*\n\n1. Use the newer `odbc::databricks()` as the driver, which automatically sets the\ndefaults for you\n\n::: {.cell}\n\n```{.r .cell-code}\ncon <- dbConnect(\n  odbc::databricks(),\n  HTTPPath = \"/sql/1.0/warehouses/300bd24ba12adf8e\"\n  )\n```\n:::\n\n\n2. Disconnect from the database using `dbDisconnect()`\n\n::: {.cell}\n\n```{.r .cell-code}\ndbDisconnect(con)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}