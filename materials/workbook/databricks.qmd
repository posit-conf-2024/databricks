---
title: "Databricks Connect"
execute: 
  eval: true
  freeze: true
  warning: false
---

```{r, setup}
#| include: false

library(dplyr)
library(dbplyr)
library(sparklyr)
library(tidymodels)
library(tidyverse)
```

```{r}
library(sparklyr)
library(dplyr)
sc <- spark_connect(method = "databricks_connect")
```

```{r}
flights_mapped <- spark_read_csv(
  sc = sc,
  name = "mapped",
  path = "/Volumes/workshops/nycflights/2013",
  memory = FALSE
  )
```

```{r}
flights_mapped |> 
  glimpse()
```
```{r}
flights_mapped |> 
  count(carrier)
```

```{r}
sdf_sql(sc, "select * from mapped limit 10")
```

```{r}
tbl_flights <- spark_read_csv(
  sc = sc, 
  name = "cached", 
  path = "/Volumes/workshops/nycflights/2013"
  )
```

```{r}
sdf_sql(sc, "select * from cached limit 10")
```

```{r}
sub_flights <- tbl_flights |> 
  select(year, month, day) |> 
  compute()
```

```{r}
sub_flights
```




