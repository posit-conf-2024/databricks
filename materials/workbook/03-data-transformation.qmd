---
title: "Data Transformation"
execute: 
  eval: true
  freeze: true
---


```{r, setup}
#| include: false
library(dplyr)
library(dbplyr)
library(DBI)
con <- dbConnect(odbc::odbc(), "warehouse", catalog = "samples")
customers <- tbl(con, in_catalog("samples", "tpch", "customer"))
orders <- tbl(con, in_catalog("samples", "tpch", "orders"))
lineitems <- tbl(con, in_catalog("samples", "tpch", "lineitem"))
```

## Group and sort records
*Learn how to use `group_by()` and `arrange()` to better understand aggregated data*

1. How many orders are there per year?
```{r}
orders %>% 
  count(year(o_orderdate))
```

2. Sort them by from highest to lowest 
```{r}
orders %>% 
  count(year(o_orderdate), sort = TRUE)
```


```{r}
orders_view <- orders %>% 
  left_join(customers, by = c("o_custkey" = "c_custkey"))
```

```{r}
orders_view %>% 
  show_query()
```
```{r}
orders_view %>% 
  group_by(c_mktsegment) %>% 
  count()
```
```{r}
orders
```

